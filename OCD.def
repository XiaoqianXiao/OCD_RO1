Bootstrap: localimage
From: OCD.0.sif

# Container Information:
# - Nilearn Version: 0.10.4 (older version)
# - YEO 2011 Atlas: Uses default 7-network thick parcellation (no parameters supported)
# - Power 2011 Atlas: Requires local atlas file (power_2011_atlas.nii.gz)
# - Schaefer 2018 Atlas: Supports parameters (n_rois, yeo_networks, resolution_mm)
# - Harvard-Oxford Atlas: Supports variants (cort, sub, maxprob, thr25, thr50, 2mm)
# - AAL Atlas: No parameters required
# - Talairach Atlas: No parameters required

%environment
    export DEBIAN_FRONTEND=noninteractive
    export FSLDIR=/usr/local/fsl
    export PATH=${FSLDIR}/bin:$PATH
    export FSLOUTPUTTYPE=NIFTI_GZ

%files
    STV_1st.py /app/STV_1st.py
    STV_group.py /app/STV_group.py
    NW_1st.py /app/NW_1st.py
    ROI_1st.py /app/ROI_1st.py
    PCC_ROI_1st.py /app/PCC_ROI_1st.py
    NW_group.py /app/NW_group.py
    NW_group2.py /app/NW_group2.py
    NW_group3.py /app/NW_group3.py
    ROI_group.py /app/ROI_group.py

%post
    chmod +x /app/STV_1st.py
    chmod +x /app/STV_group.py
    chmod +x /app/NW_1st.py
    chmod +x /app/NW_group.py
    chmod +x /app/NW_group2.py
    chmod +x /app/NW_group3.py
    chmod +x /app/ROI_1st.py
    chmod +x /app/ROI_group.py
    chmod +x /app/PCC_ROI_1st.py

%runscript
    if the first argument is "roi-to-roi":
    run: python3 /app/NW_1st.py with all arguments after the first one
else if the first argument is "first-level":
    run: python3 /app/STV_1st.py with all arguments after the first one
else if the first argument is "first-level-pcc-ROI":
    run: python3 /app/PCC_ROI_1st.py with all arguments after the first one
else if the first argument is "first-level-roi":
    run: python3 /app/ROI_1st.py with all arguments after the first one
else if the first argument is "group-level-STV":
    run: python3 /app/STV_group.py with all arguments after the first one
else if the first argument is "group-level-NW":
    run: python3 /app/NW_group.py with all arguments after the first one
else if the first argument is "group-level-ROI":
    run: python3 /app/ROI_group.py with all arguments after the first one
else if the first argument is "group-level-NW2":
    run: python3 /app/NW_group2.py with all arguments after the first one
else if the first argument is "group-level-NW3":
    run: python3 /app/NW_group3.py with all arguments after the first one
else:
    print: "Usage: apptainer run [roi-to-roi|first-level|group-level] [script arguments]"
    print: "Example: apptainer run OCD.sif roi-to-roi --subject sub-AOCD001"
    print: "Example: apptainer run OCD.sif first-level --subject sub-AOCD001"
    print: "Example: apptainer run OCD.sif group-level-NW --subjects_csv /subjects.csv"
    print: "Example: apptainer run OCD.sif group-level-NW3 --subjects_csv /subjects.csv"
    exit with error code 1